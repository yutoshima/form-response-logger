# Form Response Logger ユーザーマニュアル

バージョン 1.0.0

## 目次

1. [はじめに](#はじめに)
2. [インストールと起動](#インストールと起動)
3. [メイン画面](#メイン画面)
4. [問題の作成](#問題の作成)
5. [設定](#設定)
6. [アンケートの実施](#アンケートの実施)
7. [データの確認](#データの確認)
8. [トラブルシューティング](#トラブルシューティング)

---

## はじめに

### Form Response Loggerとは

Form Response Loggerは、研究用アンケートを実施するためのデスクトップアプリケーションです。以下の特徴があります：

- **使いやすいインターフェース**: Google Formsのような直感的な操作
- **詳細なログ記録**: すべての回答者の行動を記録
- **柔軟な問題作成**: HTML書式を使った豊かな表現
- **データの完全性**: 衝動的な変更を防ぐ仕組み

### 主な用途

- 心理学研究のアンケート調査
- ユーザビリティテスト
- 意思決定プロセスの分析
- 教育評価

---

## インストールと起動

### 必要な環境

- **OS**: Windows 10/11、macOS 10.14以降、Linux
- **Java**: バージョン11以降

### Javaのインストール確認

ターミナル（コマンドプロンプト）で以下を実行：

```bash
java -version
```

バージョン11以降が表示されればOKです。

### アプリケーションの起動

#### Windows
`run.bat`をダブルクリック

#### macOS/Linux
ターミナルで以下を実行：
```bash
./run.sh
```

#### またはJARファイルから直接実行
```bash
java -jar target/form-app-1.0.0.jar
```

### 初回起動時の自動生成

初めて起動すると、以下のフォルダとファイルが自動的に作成されます：

```
プロジェクトフォルダ/
├── config.json                    # 設定ファイル
└── data/
    ├── questions/                 # 問題ファイル格納フォルダ
    │   └── sample_questions.csv   # サンプル問題
    ├── responses/                 # 回答ファイル格納フォルダ
    └── logs/                      # ログファイル格納フォルダ
```

---

## メイン画面

### 画面構成

メイン画面には3つのボタンがあります：

1. **問題を作成** - 新しいアンケート問題を作成
2. **アンケートに回答** - 作成した問題に回答
3. **⚙ 設定** - アプリケーションの設定

---

## 問題の作成

### 基本的な手順

1. メイン画面で**「問題を作成」**をクリック
2. 問題エディター画面が開きます

### 問題エディター画面の構成

#### 質問文エリア
- 問題の本文を入力
- HTMLタグで書式設定が可能（後述）

#### 選択肢エリア
- デフォルトで4つの選択肢入力欄
- **「選択肢を追加」**ボタンで最大10個まで追加可能
- 各選択肢の右側の**「削除」**ボタンで削除可能

#### 問題リストエリア
- 追加した問題の一覧を表示
- **ダブルクリック**または**「✎ 編集」**ボタンで編集
- **「↑ 上へ」「↓ 下へ」**ボタンで順序変更
- **「✕ 削除」**ボタンで削除

### 問題の追加

1. 質問文を入力
2. 選択肢を入力（最低2つ必要）
3. **「問題を追加」**をクリック
4. 問題リストに追加されます

### 問題の編集

#### 方法1: ダブルクリック
問題リストの項目をダブルクリック

#### 方法2: 編集ボタン
1. 問題リストで編集したい問題を選択
2. **「✎ 編集」**ボタンをクリック

#### 編集モード
- 画面上部に**【編集モード - 問題 X を編集中】**と表示
- 質問文と選択肢を修正
- **「問題を更新」**をクリックで保存
- **「キャンセル」**をクリックで編集を中止

### HTML書式の使用

**重要**: HTML書式を使用するには、設定画面で「HTML表示」を有効にする必要があります。長い問題文には、プレーンテキストモード（HTML表示OFF）を推奨します。

問題文にHTML書式を使用できます（HTML表示ONの場合のみ）。

#### 基本的なタグ

**太字**
```
これは<b>重要</b>な問題です
```
表示: これは**重要**な問題です

**斜体**
```
これは<i>補足</i>情報です
```
表示: これは*補足*情報です

**下線**
```
<u>この部分</u>に注意
```
表示: <u>この部分</u>に注意

**改行**
```
1行目<br>2行目
```

**色付き文字**
```
<font color="red">赤い文字</font>
```

#### 高度な例

```html
<html>
<head>
  <style>
    .important { color: red; font-weight: bold; }
    .note { color: gray; font-size: 12pt; }
  </style>
</head>
<body>
  <h3>質問1</h3>
  <p>以下の<span class="important">重要な</span>項目についてお答えください。</p>
  <p class="note">※複数回答可</p>
</body>
</html>
```

### 問題の保存

1. すべての問題を追加・編集したら**「保存」**をクリック
2. ファイル選択ダイアログが表示されます
3. ファイル名を入力（拡張子は自動）
4. **CSV**または**JSON**形式を選択
5. **「保存」**をクリック

#### CSV形式の例
```csv
問題番号,質問文,選択肢1,選択肢2,選択肢3,選択肢4
1,好きな色は？,赤,青,緑,黄色
2,HTMLの例は<b>これ</b>です,選択肢A,選択肢B,,
```

### 問題の読み込み

1. **「読み込み」**をクリック
2. ファイルを選択
3. 問題リストに読み込まれます

---

## 設定

### 設定画面を開く

メイン画面で**「⚙ 設定」**をクリック

### ファイル設定

#### 被験者名・被験者ID
- 参加者の名前とIDを入力
- ファイル名のテンプレートで使用可能

#### 問題ファイル
- **「参照」**ボタンでファイルを選択
- 選択したファイルが自動的に読み込まれます

#### ログ出力ディレクトリ
- ログファイルの保存先フォルダ
- デフォルト: `data/logs`

#### ログファイル名フォーマット
- ログファイル名のテンプレート
- デフォルト: `action_log_{respondent_id}_{date}.csv`

#### 回答出力ディレクトリ
- 回答ファイルの保存先フォルダ
- デフォルト: `data/responses`

#### 回答ファイル名フォーマット
- 回答ファイル名のテンプレート
- デフォルト: `responses_{respondent_id}_{date}.csv`

### ファイル名テンプレート変数

以下の変数が使用できます：

| 変数 | 説明 | 例 |
|------|------|-----|
| `{date}` | 日付（年月日） | 20250120 |
| `{time}` | 時刻（時分秒） | 143000 |
| `{respondent_id}` | 自動生成ID | abc12345 |
| `{participant_name}` | 被験者名 | 田中太郎 |
| `{participant_id}` | 被験者ID | S001 |
| `{sequence}` | 連番（3桁） | 001, 002, 003 |

#### テンプレート例

**例1**: 日付と連番
```
responses_{date}_{sequence}.csv
→ responses_20250120_001.csv
```

**例2**: 被験者名と時刻
```
log_{participant_name}_{time}.csv
→ log_田中太郎_143000.csv
```

### データ設定

#### 出力形式
- **csv**: CSV形式のみ
- **json**: JSON形式のみ
- **both**: 両方の形式で出力

#### HTML表示
- **有効にする**: HTML書式設定（太字、色など）が使える短文用モード
- **無効にする**: プレーンテキスト表示で長文に対応（縦スクロール）
- デフォルト: 無効（プレーンテキストモード）

#### デフォルト選択肢数
- 問題エディターで最初に表示される選択肢の数
- 2〜10から選択

#### 選択肢の列数
- アンケート画面での選択肢の表示列数
- 1〜4列から選択

#### ログ連番（次回）
- 次に作成されるログファイルの連番
- 手動で変更可能

#### 回答連番（次回）
- 次に作成される回答ファイルの連番
- 手動で変更可能

#### 自動保存
- チェックを入れると設定に基づいて自動保存
- チェックを外すと手動でファイル選択

#### 被験者情報を使用
- チェックを入れるとアンケート開始時に名前とIDを入力
- チェックを外すと入力画面をスキップ

#### コンテンツ横幅
- アンケート画面の表示幅を設定
- 小（540px）、中（720px）、大（960px）、特大（1140px）から選択
- デフォルト: 中（720px）

### ボタン文言設定

各ボタンの表示テキストをカスタマイズできます：

| 設定項目 | デフォルト値 | 説明 |
|---------|-------------|------|
| 問題作成ボタン | 問題を作成 | メイン画面のボタン |
| アンケート開始ボタン | アンケートに回答 | メイン画面のボタン |
| 次の問題ボタン | 次の問題へ | アンケート画面のナビゲーション |
| 前の問題ボタン | 前の問題へ | アンケート画面のナビゲーション |
| 選び直すボタン | 選択肢を選び直す | 理由入力欄の下 |
| 回答終了ボタン | 回答を終了する | 最終問題の次へボタン |

**注**: config.jsonを直接編集しても設定可能です。

### 設定の保存

**「保存」**ボタンをクリックして設定を保存

---

## アンケートの実施

### アンケートの開始

1. メイン画面で**「アンケートに回答」**をクリック
2. 被験者情報入力画面が表示（設定で有効化している場合）
3. 名前とIDを入力して**「OK」**

### 問題ファイルの選択

設定で問題ファイルが指定されていない場合：
1. ファイル選択ダイアログが表示
2. 問題ファイル（CSV/JSON）を選択
3. **「開く」**をクリック

### アンケート画面の構成

#### 進捗表示
- 画面上部に「問題 1 / 10」のように表示

#### 問題文
- HTML表示ON: HTML書式で表示（短文用）
- HTML表示OFF: プレーンテキストで表示（長文用・縦スクロール対応）
- 長い問題文は縦スクロール可能

#### 選択肢
- ボタン形式で表示
- クリックすると緑色にハイライト
- HTML書式で自動改行

#### 理由入力欄
- 選択肢を選んだ理由を記入
- 選択するまで入力不可

#### ステータス表示
- 画面下部に状態メッセージを表示

#### ナビゲーションボタン
- **「前の問題へ」**: 前の問題に戻る（1問目では無効）
- **「次の問題へ」**: 次の問題へ進む
- **「回答を終了する」**: 最終問題で表示される終了ボタン

### 回答の手順

#### 1. 選択肢を選ぶ
- いずれかの選択肢ボタンをクリック
- 選択したボタンが緑色にハイライト
- 理由入力欄が有効化される

#### 2. 理由を記入
- 理由入力欄に選択した理由を記入
- **重要**: 一文字でも入力すると選択肢が変更できなくなります

#### 3. 次の問題へ
- **「次の問題へ」**ボタンをクリック
- 次の問題が表示されます

### 回答変更のルール

#### 理由を書く前
- 選択肢を自由に変更できます
- 何度でも選び直し可能

#### 理由を書き始めた後
- 選択肢の変更ができなくなります
- 画面に「選択肢を選び直すまで変更できません」と表示

#### 選択肢を変更したい場合
1. **「選択肢を選び直す」**ボタンをクリック
2. 理由入力欄がクリアされます
3. 選択肢を選び直せるようになります
4. 理由を再入力

**注意**: このルールは熟考した回答を促し、衝動的な変更を防ぐためのものです。

### アンケートの完了

最後の問題で**「回答を終了する」**をクリックすると：
1. 回答データが自動保存されます
2. 保存先のパスが表示されます
3. **「OK」**でメイン画面に戻ります

---

## データの確認

### 回答データ（CSV形式）

保存場所: `data/responses/responses_XXX.csv`

#### ファイル構造
```csv
回答者ID,タイムスタンプ,問題番号,質問文,選択した選択肢,理由
abc12345,2025-01-20 14:30:00,1,好きな色は？,青,落ち着いた色だから
abc12345,2025-01-20 14:30:15,2,好きな季節は？,秋,過ごしやすいから
```

#### データ項目

| 項目 | 説明 |
|------|------|
| 回答者ID | 自動生成される8文字のID |
| タイムスタンプ | 回答した日時 |
| 問題番号 | 問題の番号 |
| 質問文 | 問題文（HTMLタグ含む） |
| 選択した選択肢 | 選んだ選択肢のテキスト |
| 理由 | 記入した理由 |

### ログデータ（CSV形式）

保存場所: `data/logs/action_log_XXX.csv`

#### ファイル構造
```csv
タイムスタンプ,アクション種別,詳細情報
2025-01-20 14:30:00.123,選択肢選択,問題1: 青
2025-01-20 14:30:05.456,理由入力開始,問題1
2025-01-20 14:30:10.789,理由入力内容,問題1: 落ち着いた色だから
2025-01-20 14:30:15.012,問題移動,問題1 → 問題2
```

#### アクション種別

| 種別 | 説明 |
|------|------|
| 選択肢選択 | 選択肢をクリックした |
| 理由入力開始 | 理由入力欄に最初の文字を入力した |
| 理由入力内容 | 入力した理由の内容 |
| 理由書き直し | 「選択肢を選び直す」をクリックした |
| 問題移動 | 次/前の問題に移動した |
| アンケート送信 | アンケートを完了した |

### ExcelでCSVを開く

#### Windows/Mac
1. CSVファイルをExcelで開く
2. UTF-8（BOM付き）で保存されているため、日本語も正しく表示されます

#### 文字化けする場合
1. Excelで「データ」→「テキストから」
2. ファイルを選択
3. エンコーディング: **UTF-8**を選択
4. 区切り文字: **カンマ**を選択

---

## トラブルシューティング

### アプリケーションが起動しない

#### Javaがインストールされているか確認
```bash
java -version
```

バージョン11以降が必要です。

#### エラーメッセージを確認
ターミナルから起動して、エラーメッセージを確認：
```bash
java -jar target/form-app-1.0.0.jar
```

### 問題ファイルが読み込めない

#### ファイル形式を確認
- CSVファイルはUTF-8エンコーディングで保存
- ヘッダー行が必要：`問題番号,質問文,選択肢1,選択肢2,...`

#### カンマの扱い
質問文や選択肢にカンマが含まれる場合はダブルクォートで囲む：
```csv
1,"これは、カンマを含む質問です",選択肢1,選択肢2
```

### ログが出力されない

#### コンソール出力を確認
アプリケーション起動時のコンソールに以下のメッセージが表示されるか確認：
```
ログディレクトリを作成: .../data/logs (成功: true)
ログファイルを初期化しました: .../data/logs/action_log_XXX.csv
```

#### ディレクトリの権限を確認
- `data/logs`フォルダに書き込み権限があるか確認
- 手動でフォルダを作成してみる

### 日本語が文字化けする

#### CSVファイルの確認
- UTF-8（BOM付き）で保存されているか確認
- テキストエディタで開いて文字コードを確認

#### Excelでの開き方
「データ」→「テキストから」でUTF-8を指定して開く

### 選択肢が変更できない

これは仕様です：
1. 理由を書き始めると選択肢が変更できなくなります
2. **「選択肢を選び直す」**ボタンをクリックしてリセット
3. 選択肢を選び直して理由を再入力

### 回答データが保存されない

#### 設定を確認
1. 設定画面で回答出力ディレクトリを確認
2. ディレクトリが存在するか確認
3. 書き込み権限があるか確認

#### 自動保存の確認
設定で「自動保存」がチェックされているか確認

### HTMLタグが表示されない

#### タグの確認
- `<b>太字</b>` のように正しく閉じられているか
- HTMLタグが正しい構文か確認

#### プレビュー
問題作成後、アンケート画面で表示を確認

---

## よくある質問（FAQ）

### Q1: 複数の回答者のデータを管理するには？

**A**: ファイル名テンプレートで`{sequence}`や`{participant_name}`を使用します。
```
設定例: responses_{participant_name}_{sequence}.csv
結果: responses_田中太郎_001.csv, responses_山田花子_002.csv
```

### Q2: 選択肢の数を問題ごとに変えられますか？

**A**: はい、問題ごとに2〜10個の選択肢を設定できます。CSVファイルでは空の列を残してください。

### Q3: 画像を問題文に含められますか？

**A**: 現在のバージョンでは画像の直接埋め込みには対応していません。HTMLの`<img>`タグも使用できません。

### Q4: アンケート途中で終了した場合、データは保存されますか？

**A**: いいえ、最後の問題まで完了した時点で保存されます。途中のデータは保存されません。

### Q5: 回答時間を記録できますか？

**A**: はい、ログファイルに全てのアクションがミリ秒単位のタイムスタンプ付きで記録されます。

---

## サポート

### 問い合わせ先

- **GitHubリポジトリ**: https://github.com/yutoshima/form-response-logger
- **Issue報告**: https://github.com/yutoshima/form-response-logger/issues
- **ディスカッション**: https://github.com/yutoshima/form-response-logger/discussions

### ドキュメント

- **README**: プロジェクト概要
- **CONTRIBUTING**: 開発者向けガイド
- **このマニュアル**: 詳細な使用方法

---

**最終更新**: 2025年1月
**バージョン**: 1.0.0
