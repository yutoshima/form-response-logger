# Form Response Logger

研究用アンケートアプリケーション - 詳細なログ機能付き

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Java](https://img.shields.io/badge/Java-11+-orange.svg)](https://www.oracle.com/java/)
[![Maven](https://img.shields.io/badge/Maven-3.6+-red.svg)](https://maven.apache.org/)

[English](README.md) | 日本語

## 概要

Form Response Loggerは、研究用アンケートを実施するためのデスクトップアプリケーションです。Java SwingとFlatLafで構築され、Google Formsのような使いやすいインターフェースを提供しながら、研究データの完全性を保証する詳細なログ機能を備えています。

## 主な機能

### アンケート作成・管理
- **GUIベースの問題エディター**: 直感的なインターフェースで問題と選択肢を作成
- **HTML対応**: 問題文に太字、斜体、色などのリッチテキスト書式を使用可能
- **問題編集**: 問題リストをダブルクリックして既存の問題を編集
- **柔軟な問題管理**: 問題の並び替えや削除が簡単
- **複数のエクスポート形式**: CSVまたはJSON形式で保存
- **自動読み込み**: 設定したディレクトリから問題ファイルを自動読み込み

### 回答収集
- **視覚的フィードバック**: 選択した選択肢がハイライト表示
- **表示モード選択**: HTML表示（短文・書式設定可）またはプレーンテキスト（長文・縦スクロール対応）を選択可能
- **自動改行**: 長い問題文と選択肢は自動的に改行
- **理由の記録**: 回答者に選択理由の説明を求める
- **回答変更ルール**: 理由入力開始後の衝動的な変更を防止
- **完全なアクションログ**: すべてのユーザーアクションがタイムスタンプ付きで記録され、詳細なコンソール出力

### データ管理
- **参加者情報**: 参加者の名前とIDを収集・管理
- **柔軟なファイル命名**: 日付、時刻、参加者情報で自動的にファイル名を生成
- **連番管理**: ログと回答で独立した連番を管理
- **二重形式エクスポート**: CSV（Excel互換UTF-8 BOM付き）またはJSON、あるいは両方で出力

### カスタマイズ
- **レイアウトオプション**: 選択肢を1〜4列で表示
- **コンテンツ横幅**: 小（540px）〜特大（1140px）の4段階
- **ボタン文言**: 各ボタンの表示テキストをカスタマイズ可能
- **外観**: ライト/ダークモード、カラーテーマ、フォントサイズのカスタマイズ
- **設定可能なパス**: 問題、回答、ログのカスタムディレクトリを設定

## 動作環境

- Java 11以上
- Maven 3.6以上

## インストールと実行

### ソースからビルド

```bash
# リポジトリをクローン
git clone https://github.com/yutoshima/form-response-logger.git
cd form-response-logger

# Mavenでビルド
mvn clean package

# アプリケーションを実行
java -jar target/form-app-1.0.0.jar
```

### クイックスタートスクリプト

```bash
# macOS/Linux
./run.sh

# Windows
run.bat
```

### Mavenで実行

```bash
mvn exec:java -Dexec.mainClass="com.study.form.SurveyApp"
```

## クイックスタートガイド

### 1. 初回起動

初回起動時、アプリケーションは以下を自動的に作成します：
- `data/questions/` - 問題ファイルディレクトリ
- `data/responses/` - 回答ファイルディレクトリ
- `data/logs/` - ログファイルディレクトリ
- `config.json` - 設定ファイル
- `data/questions/sample_questions.csv` - サンプル問題

### 2. 問題を作成

1. **「問題を作成」**をクリック
2. 問題文と選択肢を入力（最低2つの選択肢が必要）
   - **プレーンテキスト**: シンプルなテキスト問題
   - **HTML書式**: HTMLタグでリッチな書式設定（下記参照）
3. **「問題を追加」**をクリック
4. **問題の編集**: リスト内の問題をダブルクリックして編集
5. **↑/↓**ボタンで並び替え、**✕**で削除
6. **「保存」**をクリックしてCSVまたはJSON形式を選択

#### 問題文のHTML書式設定

**重要**: HTML書式は、設定で「HTML表示」を有効にした場合のみ使用できます。長い問題文には、プレーンテキストモードを使用してください。

問題文にHTMLタグを使用して書式設定できます：

**基本的な例**（CSVファイル内）：
```csv
問題番号,質問文,選択肢1,選択肢2,選択肢3,選択肢4
1,これは<b>重要</b>な質問です。<br>次の選択肢から選んでください。,選択肢A,選択肢B,選択肢C,選択肢D
```

**サポートされるHTMLタグ**：
- `<b>太字</b>` または `<strong>太字</strong>` - 太字
- `<i>斜体</i>` または `<em>斜体</em>` - 斜体
- `<u>下線</u>` - 下線
- `<br>` - 改行
- `<font color="red">赤い文字</font>` - 色付き文字
- `<p>段落</p>` - 段落

**高度な例**：
```csv
問題番号,質問文,選択肢1,選択肢2
1,"<html><body><h3>アンケート質問1</h3><p>以下の<b>重要な</b>項目について、<i>慎重に</i>お答えください。</p></body></html>",はい,いいえ
```

詳しい例は`data/questions/html_test.csv`を参照してください。

### 3. 設定（オプション）

**「⚙ 設定」**をクリックして設定：

- **参加者情報**: 参加者名とIDの収集を有効/無効化
- **ファイルパス**: 問題、回答、ログのディレクトリを設定
- **出力形式**: CSV、JSON、または両方を選択
- **レイアウト**: 選択肢の列数（1〜4列）、コンテンツ横幅（小〜特大）を設定
- **ボタン文言**: 各ボタンの表示テキストをカスタマイズ
- **表示モード**:
  - **HTML表示ON**: HTML書式設定（太字、色など）が使える短文用モード
  - **HTML表示OFF**: プレーンテキスト表示で長文に対応（縦スクロール）
- **連番**: 自動増加ファイルカウンターを管理

**ファイル名テンプレート変数**：
- `{date}` - 日付（YYYYMMDD）
- `{time}` - 時刻（HHMMSS）
- `{respondent_id}` - 自動生成される8文字のUUID
- `{participant_name}` - 設定からの参加者名
- `{participant_id}` - 設定からの参加者ID
- `{sequence}` - 自動増加する3桁の番号（001、002、...）

**例**： `responses_{participant_name}_{sequence}.csv` → `responses_田中太郎_001.csv`

### 4. アンケートを実施

1. **「アンケートに回答」**をクリック
2. 参加者情報を入力（有効化されている場合）
3. 各問題について：
   - 選択肢を選択（緑色でハイライト表示）
   - 理由を記入
   - **「次の問題へ」**をクリック
4. 回答は最後に自動的に保存されます

## 回答変更ルール

データの完全性を確保するため：
- **理由を書く前**: 選択肢を自由に変更可能
- **理由入力開始後**: 選択肢がロックされる
- **選択肢を変更する場合**: **「選択肢を選び直す」**をクリックしてロック解除とリセット

このメカニズムにより、熟考した回答を促し、衝動的な変更を防ぎます。

## プロジェクト構造

```
src/main/java/com/study/form/
├── SurveyApp.java           # メインエントリーポイント
├── Constants.java           # 定数の一元管理（45以上の定数）
├── model/                   # データモデル
│   ├── Question.java        # 問題と選択肢
│   ├── Response.java        # アンケート回答データ
│   └── Config.java          # アプリケーション設定
├── util/                    # ビジネスロジックユーティリティ
│   ├── ConfigManager.java   # 設定ファイル管理
│   ├── ActionLogger.java    # ユーザーアクションログ
│   └── FileUtils.java       # CSV/JSON入出力
└── ui/                      # ユーザーインターフェース（Swing）
    ├── MainWindow.java
    ├── QuestionEditorWindow.java
    ├── SurveyInterfaceWindow.java
    ├── SettingsWindow.java
    └── ParticipantInfoWindow.java
```

## データ形式

### 問題ファイル（CSV）

```csv
問題番号,質問文,選択肢1,選択肢2,選択肢3,選択肢4
1,好きな色は？,赤,青,緑,黄色
2,これは<b>HTML</b>の例です,選択肢1,選択肢2,,
```

### 回答ファイル（CSV）

```csv
回答者ID,タイムスタンプ,問題番号,質問文,選択した選択肢,理由
abc12345,2025-01-20 14:30:00,1,好きな色は？,青,落ち着いた色だから
```

### ログファイル（CSV）

```csv
タイムスタンプ,アクション種別,詳細情報
2025-01-20 14:30:00.123,選択肢選択,問題1: 青
2025-01-20 14:30:05.456,理由入力開始,問題1
```

## 技術スタック

- **言語**: Java 11+
- **ビルドツール**: Maven 3.6+
- **UIフレームワーク**: Java Swing
- **外観**: FlatLaf（モダンなLook and Feel）
- **データ形式**: CSV（UTF-8 BOM）、JSON
- **JSONライブラリ**: Google Gson

## アーキテクチャ

### レイヤー構成

- **Model**: データ構造のみ、ビジネスロジックなし
- **Util**: ビジネスロジック、ファイル入出力、データ処理
- **UI**: ユーザーインターフェース、イベント処理、最小限のロジック

### 設計原則

1. **定数の一元管理**: すべてのUI要素、色、メッセージは`Constants.java`で管理
2. **関心の分離**: 各クラスは単一の責任を持つ
3. **リソース管理**: I/O操作には必ずtry-with-resourcesを使用
4. **Null安全性**: パラメータの検証と適切なエラー処理

## トラブルシューティング

### 問題ファイルが読み込めない
- ファイルがUTF-8エンコーディングか確認
- CSVヘッダーが正しい形式か確認
- 設定でファイルパスが正しいか確認

### ログが出力されない
- コンソール出力でログディレクトリの作成メッセージを確認
- ログディレクトリの書き込み権限を確認
- 設定でログ名フォーマットが正しいか確認

### 日本語が文字化けする
- すべてのファイルがUTF-8エンコーディングで保存されているか確認
- Windowsの場合、CSVファイルにBOMが含まれているか確認

## ライセンス

このプロジェクトはMITライセンスの下でライセンスされています。詳細は[LICENSE](LICENSE)ファイルを参照してください。

## 貢献

貢献を歓迎します！詳細は[CONTRIBUTING.md](CONTRIBUTING.md)を参照してください。

## サポート

- バグ報告: [Issues](https://github.com/yutoshima/form-response-logger/issues)
- 機能リクエスト: [Issues](https://github.com/yutoshima/form-response-logger/issues)
- 質問: [Discussions](https://github.com/yutoshima/form-response-logger/discussions)

## 作者

開発者ドキュメントとガイドラインについては[CONTRIBUTING.md](CONTRIBUTING.md)を参照してください。

## 謝辞

- [FlatLaf](https://www.formdev.com/flatlaf/) - モダンなLook and Feel
- [Google Gson](https://github.com/google/gson) - JSON処理
- すべての貢献者とテスター
